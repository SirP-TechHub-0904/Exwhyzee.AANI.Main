@page "/vote/{electionId:long?}"
@model Exwhyzee.AANI.Web.Areas.Datapage.Pages.ChapterVoting.IndexModel
@{
    ViewData["Title"] = "Voting";
}

<div class="card">
    <div class="card-header">
        <h4>Vote</h4>
    </div>

    <div class="card-body">
        @if (Model.Election != null)
        {
            <!-- Single election view when /vote/{id} is used -->
            <h5>@Model.Election.Title</h5>
            <p class="text-muted">@Model.Election.StartAt.ToString("yyyy-MM-dd") — @Model.Election.EndAt.ToString("yyyy-MM-dd")</p>
            <p>Click Start Voting to enter your 7-digit code and begin.</p>
            <a class="btn btn-primary" asp-area="Datapage" asp-page="/ChapterVoting/EnterToken" asp-route-electionId="@Model.Election.Id">Start Voting</a>
        }
        else if (User?.Identity?.IsAuthenticated == true && Model.AccreditedElections?.Any() == true)
        {
            <!-- Show list of elections the logged-in user is accredited to -->
            <h5>Your eligible elections</h5>
            <div class="list-group">
                @foreach (var e in Model.AccreditedElections)
                {
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <div class="fw-bold">@e.Title</div>
                            <div class="small text-muted">@e.StartAt.ToString("yyyy-MM-dd") — @e.EndAt.ToString("yyyy-MM-dd")</div>
                        </div>
                        <div>
                            <a class="btn btn-sm btn-outline-primary" href="/vote/@e.Id">Start Voting</a>
                        </div>
                    </div>
                }
            </div>
        }
        else if (User?.Identity?.IsAuthenticated == true)
        {
            <!-- Signed-in but no accredited elections -->
            <p>You are not accredited to vote at this time.</p>
        }
        else
        {
            <!-- Not signed-in -->
            <p>Please sign in to see elections you are accredited to.</p>
            <a class="btn btn-secondary" href="/Identity/Account/Login">Sign in</a>
            <p class="text-muted small mt-2">If you have a direct link, open it with the electionId (example: /vote/123).</p>
        }
    </div>
</div>


<style>
    @@media (max-width: 992px) {

        .btn-group-sm > .btn, .btn-sm {
            padding: .25rem .5rem;
            font-size: 0.75rem;
            font-weight: bolder;
            line-height: 1.2;
            border-radius: .2rem;
            width:100%;
        }
        .d-flex {
            display: -ms-flexbox !important;
            display: block !important;
        }
    }
</style>