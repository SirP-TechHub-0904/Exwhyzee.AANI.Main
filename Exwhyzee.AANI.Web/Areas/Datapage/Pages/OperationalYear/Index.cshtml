@page
@model Exwhyzee.AANI.Web.Areas.Datapage.Pages.OperationalYear.IndexModel

@{
    ViewData["Title"] = "Manage Operation Years";
}

<div class="card">
    <div class="card-header">
        <h3 class="card-title">MANAGE OPERATION YEARS</h3>
        <button type="button" class="btn bg-gradient-warning btn-xs" style="float:right;" data-toggle="modal" data-target="#addModal">
            Create New Year
        </button>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>@Html.DisplayNameFor(model => model.OperationYear[0].Name)</th>
                        <th>@Html.DisplayNameFor(model => model.OperationYear[0].StartDate)</th>
                        <th>@Html.DisplayNameFor(model => model.OperationYear[0].EndDate)</th>
                        <th>Status</th>
                        <th style="width: 150px;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.OperationYear)
                    {
                        <tr>
                            <td>@Html.DisplayFor(modelItem => item.Name)</td>
                            <td>@item.StartDate.ToString("dd MMM, yyyy")</td>
                            <td>@item.EndDate.ToString("dd MMM, yyyy")</td>
                            <td>
                                @if (item.IsActive)
                                {
                                    <span class="badge badge-success">Active</span>
                                }
                                else
                                {
                                    <span class="badge badge-secondary">Inactive</span>
                                }
                            </td>
                            <td>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-xs btn-success">Action</button>
                                    <button type="button" class="btn btn-xs btn-success dropdown-toggle dropdown-icon" data-toggle="dropdown" aria-expanded="false">
                                    </button>
                                    <div class="dropdown-menu" style="">
                                        <button type="button" class="dropdown-item edit-btn" data-id="@item.Id" data-toggle="modal" data-target="#editModal">
                                            <i class="fas fa-edit mr-2"></i> Edit
                                        </button>
                                        <button type="button" class="dropdown-item delete-btn" data-id="@item.Id" data-name="@item.Name" data-toggle="modal" data-target="#deleteModal">
                                            <i class="fas fa-trash-alt mr-2"></i> Delete
                                        </button>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- === ADD MODAL === -->
<div class="modal fade" id="addModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form method="post" asp-page-handler="Create">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Operation Year</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label asp-for="Input.Name"></label>
                        <input asp-for="Input.Name" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label asp-for="Input.StartDate"></label>
                        <input asp-for="Input.StartDate" type="date" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label asp-for="Input.EndDate"></label>
                        <input asp-for="Input.EndDate" type="date" class="form-control" />
                    </div>
                    <!-- IsActive Checkbox -->
                    <div class="form-group form-check">
                        <input type="checkbox" asp-for="Input.IsActive" class="form-check-input" />
                        <label class="form-check-label" asp-for="Input.IsActive">Set as Active Term</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Create</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- === EDIT MODAL === -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form method="post" asp-page-handler="Update">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Operation Year</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <input type="hidden" asp-for="Input.Id" id="editId" />
                    <div class="form-group">
                        <label asp-for="Input.Name"></label>
                        <input asp-for="Input.Name" class="form-control" id="editName" />
                    </div>
                    <div class="form-group">
                        <label asp-for="Input.StartDate"></label>
                        <input asp-for="Input.StartDate" type="date" class="form-control" id="editStartDate" />
                    </div>
                    <div class="form-group">
                        <label asp-for="Input.EndDate"></label>
                        <input asp-for="Input.EndDate" type="date" class="form-control" id="editEndDate" />
                    </div>
                    <!-- IsActive Checkbox -->
                    <div class="form-group form-check">
                        <input type="checkbox" asp-for="Input.IsActive" class="form-check-input" id="editIsActive" />
                        <label class="form-check-label" asp-for="Input.IsActive">Set as Active Term</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- === DELETE MODAL === -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form method="post" asp-page-handler="Delete">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm Deletion</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete the term <strong id="deleteName"></strong>?</p>
                    <input type="hidden" name="id" id="deleteId" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Delete</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(function () {
            // Script for Edit Modal
            $('.edit-btn').on('click', function () {
                var id = $(this).data('id');
                // Use AJAX to get the data for the selected year
                $.ajax({
                    url: '?handler=Json&id=' + id,
                    type: 'GET',
                    success: function (data) {
                        // Format dates for the input[type=date]
                        var startDate = new Date(data.startDate).toISOString().split('T')[0];
                        var endDate = new Date(data.endDate).toISOString().split('T')[0];

                        // Populate the modal fields
                        $('#editId').val(data.id);
                        $('#editName').val(data.name);
                        $('#editStartDate').val(startDate);
                        $('#editEndDate').val(endDate);
                        // Set the checkbox state
                        $('#editIsActive').prop('checked', data.isActive);

                    }
                });
            });

            // Script for Delete Modal
            $('.delete-btn').on('click', function () {
                var id = $(this).data('id');
                var name = $(this).data('name');
                $('#deleteId').val(id);
                $('#deleteName').text(name);
            });
        });
    </script>
}