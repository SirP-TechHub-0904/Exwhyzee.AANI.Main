@page
@model Exwhyzee.AANI.Web.Areas.Datapage.Pages.NewsletterPage.Templates.CreateModel
@{
    ViewData["Title"] = "Create Template";
}
<div class="card card-default">
    <div class="card-header">
        <h3 class="card-title">Create Message Template</h3>
    </div>

    @await Html.PartialAsync("_MessageNotice")

    <div class="card-body">
        <form method="post">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <div class="form-group">
                <label asp-for="MessageTemplate.Name"></label>
                <input asp-for="MessageTemplate.Name" class="form-control" />
                <span asp-validation-for="MessageTemplate.Name" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="MessageTemplate.MessageType"></label>
                <select asp-for="MessageTemplate.MessageType" asp-items="Model.MessageTypeList" class="form-control"></select>
                <span asp-validation-for="MessageTemplate.MessageType" class="text-danger"></span>
            </div>
             
            <div class="form-group">
                <label asp-for="MessageTemplate.Body"></label>
                <textarea asp-for="MessageTemplate.Body" class="form-control summernote" id="" rows="8"></textarea>
                <span asp-validation-for="MessageTemplate.Body" class="text-danger"></span>
            </div>
             
            <div class="form-group">
                <div class="form-check">
                    <input asp-for="MessageTemplate.IsActive" class="form-check-input" />
                    <label asp-for="MessageTemplate.IsActive" class="form-check-label">Is Active</label>
                </div>
            </div>

            <div>
                <button type="submit" class="btn btn-primary">Create Template</button> 
                <a asp-page="./Index" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    @*<script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/summernote-bs4.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/summernote-bs4.min.css" />*@

    <script>
        $(function () {
            function toggleSubject() {
                var mt = $('select[name="MessageTemplate.MessageType"]').val();
                if (mt === 'Email') {
                    $('#subjectRow').show();
                    $('#templateBodyEditor').summernote({ height: 250 });
                } else {
                    $('#subjectRow').hide();
                    if ($('#templateBodyEditor').data('summernote')) {
                        $('#templateBodyEditor').summernote('destroy');
                    }
                }
            }
            $('select[name="MessageTemplate.MessageType"]').change(toggleSubject);
            toggleSubject();

            // Preview button: post current subject/body to Preview handler

              $('#previewTemplateBtn').click(function (e) {
   e.preventDefault();
      var subject = $('input[name="MessageTemplate.Subject"]').val() || '';
      var body = '';
      if ($('#templateBodyEditor').data('summernote')) {
          body = $('#templateBodyEditor').summernote('code');
      } else {
          body = $('textarea[name="MessageTemplate.Body"]').val() || '';
      }

      $.post('@Url.Page("./Preview", "Render")', { subject: subject, body: body }, function (data) {
          $('#templatePreviewModal #previewSubject').text(data.subject || '');
          $('#templatePreviewModal #previewBody').html(data.body || '');
          $('#templatePreviewModal').modal('show');
      }).fail(function () {
          alert('Failed to render preview');
      });
  });
        });
    </script>
    <script>

    </script>
}
@await Html.PartialAsync("./_TemplatePreviewModal")